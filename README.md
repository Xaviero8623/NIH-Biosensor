# NIH-Biosensor
To access the FPGA part of the project, open Vivado, you will need the free version of vivado 2024.1. Once you are in the start menu of Vivado 2024.1 go to file and click open project, navigate to where you have downloaded the contents of this repository, and open the Final_project folder. click on the xpr file type titled Final_project. This is the file where the design for the FPGA is located. When the project opens there will be a tab titled sources on the left hand side of vivado. Within this sources tab, there will be 4 design sources, with the most important one being titled the "final_block_wrapper". This is where the block diagram for the entire FPGA design is located. If you click the arrow next to it to view its contents you will see the final_block.bd file with an orange pyramid next to it, this is the block diagram for the design. The block diagram is similar to lab view in the sense that it allows you to instantiate xilinx's already pre-developed RTL modules. For example, the clock generator is generated here within the block clk_wiz_0, this predesigned RTL IP from vivado takes in the clock signal from the existing 125 MHz clock on the actual chip and returns 3 different clock signals to the other modules. The xadc_wiz_0 block represents the analog to digital converter from xilinx. The processing_system7_0 block represents the real time processor. 
In vivado, when you write code in VHDL, you write this code within a file contained in the design sources tab. To do this click the "+" right under the sources tab. When you have finished writing your code, you can include this code in the block diagram by instantiated it as an RTL module. This can be done by right clicking on white space and selecting add module. In the block diagram for final_project, top_level_0 and XADC_interpretor_2 are RTL modules from vhdl code I wrote.
In the block diagram, you can also connect the modules to external ports. Those are the gray icons on the borders of each side. Each of these ports must be defined in a constraints file which can be added the same way you add a vhdl file. I will include the general constraints file I used in this repository and their are instructions for how to use it as well as my own example. 
My Top_level VHDL code is actually comprised of 2 separate VHDL entities which are internalized to top_level. For simplicity of the block design, I did not instantiate these modules into the block diagram, I simply just referenced them in the top_level code, but they are still running inside the top_level RTL module. 
Once the block diagram has been finished and includes all necessary parts right click on the white space and click validate design. Ignore error BD 41-1347, it is a xilinx issue and does not affect function at all. After ensuring that there are no errors, save the block diagram, and right click on it in the sources tab, click on "create HDL wrapper". After doing so click on "Generate Bitsream" within the Flow navigator. If you wish to now transfer this project to Vitis to work on the real time processor, click on File and export and follow the instructions. 

For real time processor development Vitis 2024.1 is needed. My existing vitis development is contained in the Final_project_SW. To access, open Vitis, click on open workspace, and choose Final_project_SW. You will see a platform component named Biosensor_FGPA, which represents the hardware design from vivado, and an application component named Software, which is where the real time processor development is contained. If the hardware design is changed in vivado, a new platform component will need to be created, and a new application component as these are built off of the platform component. To create a platform component, ensure that the xsa file from your vivado export is in the workspace folder, and follow the steps within the software to choose this file and build the platform using this xsa file. Then build the application component using the platform component you just developed. 
For Vitis development, the code can be written in C or C++ and the developed code should be contained in the src of the application project. The platform component contains all necessary build and header files for reference to establish communication between the FPGA and real time processor and other necessary functions. When you are ready to test this design, build the application component, this will also build the platform component, then run the program on the board. This will run both the fpga bitstream from vivado and your code from vitis. If the header files in your code are causing errors because the files cannot be found, try building just the platform component and then try and reference the header files. 

The current hardware design features the LED pulse modulation control, and the analog to digital converter. The software design currently prints the combined threshold values and the voltage reading both as 32 bit signals. To view the output, connect the board to the computer and while vitis is open, click on the vitis tab in the top left corner, press serial monitor, and select com4(FTDI). If the option for serial monitor isnt there, click new feature preview at the bottom of the tab once you press vitis, and should be able to enable the feature there. 
